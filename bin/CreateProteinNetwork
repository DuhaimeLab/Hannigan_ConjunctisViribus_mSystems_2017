#! /bin/bash

#PBS -N CreateProteinNetwork
#PBS -A pschloss_flux
#PBS -q flux
#PBS -l qos=flux
#PBS -l nodes=1:ppn=12,mem=32GB
#PBS -l walltime=100:00:00
#PBS -j oe
#PBS -V

# Load perl module
module load med perl-modules

# 1/2 Remove proxy env variables before running the perl script
unset http_proxy https_proxy ftp_proxy no_proxy HTTP_PROXY HTTPS_PROXY FTP_PROXY NO_PROXY

# Move to working directory
cd /scratch/pschloss_flux/ghannig/git/Hannigan-2016-ConjunctisViribus/bin || exit

# Start neo4j server locally
/scratch/pschloss_flux/ghannig/bin/neo4j-enterprise-2.3.2/bin/neo4j start

# 2/2 Again make sure it is unset
unset http_proxy https_proxy ftp_proxy no_proxy HTTP_PROXY HTTPS_PROXY FTP_PROXY NO_PROXY

# Run network creation
perl /scratch/pschloss_flux/ghannig/git/Hannigan-2016-ConjunctisViribus/bin/ProteinNetworkCreation.pl \
	-b ../data/PrepareProtClusters/BacteriaParsed.tsv \
	-p ../data/PrepareProtClusters/PhageParsed.tsv \
	-d ../data/phageSVA.dat

# Stop local neo4j server
/scratch/pschloss_flux/ghannig/bin/neo4j-enterprise-2.3.2/bin/neo4j stop

